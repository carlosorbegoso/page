---
interface Props {
  title?: string;
  description?: string;
  image?: string;
}

const siteUrl = 'https://carlosorbegoso.github.io/page';
const {
  title = "Carlos Orbegoso - Backend Developer & Java Specialist",
  description = "Backend Developer especializado en Java, Spring Boot y Quarkus. +5 aÃ±os de experiencia en microservicios, APIs REST y arquitecturas cloud-native.",
  image = `${siteUrl}/images/og-image.jpg`
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, siteUrl);
---

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#64B5F6" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <title>{title}</title>
    <meta name="description" content={description}>

    <!-- SEO Meta Tags -->
    <meta name="author" content="Carlos Orbegoso">
    <meta name="keywords" content="Backend Developer, Java Developer, Spring Boot, Quarkus, Microservices, Cloud Native, Software Engineer, API REST, Lima Peru, Desarrollador Backend">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <link rel="canonical" href={canonicalURL}>

    <!-- Geo Tags for Local SEO -->
    <meta name="geo.region" content="PE-LIM">
    <meta name="geo.placename" content="Lima, Peru">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content={canonicalURL}>
    <meta property="og:title" content={title}>
    <meta property="og:description" content={description}>
    <meta property="og:image" content={image}>
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Carlos Orbegoso - Backend Developer Portfolio">
    <meta property="og:locale" content="es_PE">
    <meta property="og:locale:alternate" content="en_US">
    <meta property="og:site_name" content="Carlos Orbegoso Portfolio">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content={canonicalURL}>
    <meta name="twitter:title" content={title}>
    <meta name="twitter:description" content={description}>
    <meta name="twitter:image" content={image}>
    <meta name="twitter:creator" content="@carlosorbegoso">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href={`${import.meta.env.BASE_URL}/favicon.svg`}>
    <link rel="apple-touch-icon" sizes="180x180" href={`${import.meta.env.BASE_URL}/favicon.svg`}>

    <!-- DNS Prefetch for external resources -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Structured Data / JSON-LD - Person -->
    <script is:inline type="application/ld+json" set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Carlos Orbegoso",
        "url": siteUrl,
        "image": image,
        "jobTitle": "Backend Developer",
        "description": description,
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "Lima",
            "addressCountry": "PE"
        },
        "worksFor": {
            "@type": "Organization",
            "name": "Tata Consultancy Services"
        },
        "sameAs": [
            "https://github.com/carlosorbegoso",
            "https://linkedin.com/in/carlos-orbergoso-loayza"
        ],
        "knowsAbout": ["Java", "Spring Boot", "Quarkus", "Microservices", "Cloud Native", "Backend Development", "REST API", "Docker", "Kubernetes", "AWS"]
    })} />

    <!-- Structured Data / JSON-LD - WebSite -->
    <script is:inline type="application/ld+json" set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Carlos Orbegoso Portfolio",
        "url": siteUrl,
        "description": description,
        "author": {
            "@type": "Person",
            "name": "Carlos Orbegoso"
        }
    })} />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Loader styles -->
    <style>
        /* ===== NEURAL MIND AWAKENING LOADER ===== */
        .page-loader {
            position: fixed;
            inset: 0;
            background: var(--mind-void, #030308);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            overflow: hidden;
        }

        /* Neural glow background */
        .page-loader::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background:
                radial-gradient(circle at 30% 40%, rgba(100, 181, 246, 0.06) 0%, transparent 40%),
                radial-gradient(circle at 70% 60%, rgba(0, 255, 255, 0.04) 0%, transparent 35%),
                radial-gradient(circle at 50% 50%, rgba(170, 68, 255, 0.03) 0%, transparent 50%);
            animation: neuralBgPulse 6s ease-in-out infinite;
        }

        @keyframes neuralBgPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
        }

        .page-loader.loaded {
            animation: loaderExit 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes loaderExit {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
            100% { opacity: 0; transform: scale(1.1); visibility: hidden; }
        }

        .loader-content {
            text-align: center;
            position: relative;
            z-index: 1;
        }

        /* Neural Network Logo */
        .loader-logo {
            width: 140px;
            height: 140px;
            margin: 0 auto 2.5rem;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Neural Network SVG */
        .loader-neural {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .loader-neural svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 15px rgba(100, 181, 246, 0.4));
        }

        /* Neural nodes */
        .neural-node {
            fill: var(--neural-primary, #64B5F6);
            opacity: 0;
            animation: nodeAppear 0.5s ease-out forwards;
        }

        .neural-node.cyan { fill: var(--neural-cyan, #00ffff); }
        .neural-node.purple { fill: var(--neural-purple, #aa44ff); }

        .neural-node:nth-child(1) { animation-delay: 0.2s; }
        .neural-node:nth-child(2) { animation-delay: 0.4s; }
        .neural-node:nth-child(3) { animation-delay: 0.3s; }
        .neural-node:nth-child(4) { animation-delay: 0.5s; }
        .neural-node:nth-child(5) { animation-delay: 0.6s; }
        .neural-node:nth-child(6) { animation-delay: 0.35s; }
        .neural-node:nth-child(7) { animation-delay: 0.45s; }

        @keyframes nodeAppear {
            0% { opacity: 0; transform: scale(0); }
            70% { transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Synaptic connections */
        .synapse-line {
            stroke: var(--neural-cyan, #00ffff);
            stroke-width: 1;
            stroke-dasharray: 100;
            stroke-dashoffset: 100;
            opacity: 0.4;
            animation: synapseConnect 1s ease-out forwards;
        }

        .synapse-line:nth-child(8) { animation-delay: 0.6s; }
        .synapse-line:nth-child(9) { animation-delay: 0.7s; }
        .synapse-line:nth-child(10) { animation-delay: 0.8s; }
        .synapse-line:nth-child(11) { animation-delay: 0.9s; }
        .synapse-line:nth-child(12) { animation-delay: 1s; }
        .synapse-line:nth-child(13) { animation-delay: 1.1s; }

        @keyframes synapseConnect {
            to { stroke-dashoffset: 0; }
        }

        /* Pulsing glow rings */
        .loader-pulse-ring {
            position: absolute;
            border-radius: 50%;
            border: 1px solid rgba(100, 181, 246, 0.3);
            animation: pulseExpand 2s ease-out infinite;
        }

        .loader-pulse-ring:nth-child(1) {
            width: 80px;
            height: 80px;
            animation-delay: 0s;
        }

        .loader-pulse-ring:nth-child(2) {
            width: 100px;
            height: 100px;
            animation-delay: 0.5s;
            border-color: rgba(0, 255, 255, 0.2);
        }

        .loader-pulse-ring:nth-child(3) {
            width: 120px;
            height: 120px;
            animation-delay: 1s;
            border-color: rgba(170, 68, 255, 0.15);
        }

        @keyframes pulseExpand {
            0% { transform: scale(0.8); opacity: 0.6; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        /* Central brain icon */
        .loader-brain {
            position: relative;
            z-index: 2;
            font-size: 2.5rem;
            animation: brainPulse 2s ease-in-out infinite;
            filter: drop-shadow(0 0 20px rgba(100, 181, 246, 0.5));
        }

        @keyframes brainPulse {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.05); opacity: 1; }
        }

        /* Texto */
        .loader-text {
            color: #ffffff;
            font-family: 'Inter', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: 0.05em;
            opacity: 0;
            animation: fadeInUp 0.6s ease forwards 0.8s;
        }

        .loader-role {
            display: inline-block;
            color: transparent;
            background: linear-gradient(90deg, var(--neural-primary, #64B5F6), var(--neural-cyan, #00ffff));
            -webkit-background-clip: text;
            background-clip: text;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0;
            animation: fadeInUp 0.6s ease forwards 1s;
        }

        .loader-role::after {
            content: '|';
            color: var(--neural-cyan, #00ffff);
            animation: blink 1s step-end infinite;
            margin-left: 2px;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Neural Progress Bar */
        .loader-progress-container {
            width: 280px;
            margin-top: 2.5rem;
            opacity: 0;
            animation: fadeInUp 0.6s ease forwards 1.2s;
        }

        .loader-progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .loader-progress-value {
            color: var(--neural-cyan, #00ffff);
        }

        .loader-progress {
            width: 100%;
            height: 2px;
            background: rgba(100, 181, 246, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .loader-progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg,
                var(--neural-primary, #64B5F6),
                var(--neural-cyan, #00ffff),
                var(--neural-purple, #aa44ff));
            background-size: 200% 100%;
            border-radius: 10px;
            animation: neuralFlow 2s ease infinite;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
            transition: width 0.3s ease-out;
        }

        @keyframes neuralFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Neural skill nodes */
        .loader-skills {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            margin-top: 1.5rem;
            flex-wrap: wrap;
            max-width: 300px;
        }

        .loader-skill {
            padding: 0.35rem 0.85rem;
            background: rgba(100, 181, 246, 0.05);
            border: 1px solid rgba(100, 181, 246, 0.2);
            border-radius: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            color: rgba(255, 255, 255, 0.7);
            opacity: 0;
            transform: scale(0.8);
            box-shadow: 0 0 10px rgba(100, 181, 246, 0.1);
        }

        .loader-skill:nth-child(1) { animation: skillPop 0.4s ease forwards 1.4s; }
        .loader-skill:nth-child(2) { animation: skillPop 0.4s ease forwards 1.5s; }
        .loader-skill:nth-child(3) { animation: skillPop 0.4s ease forwards 1.6s; }
        .loader-skill:nth-child(4) { animation: skillPop 0.4s ease forwards 1.7s; }

        @keyframes skillPop {
            to { opacity: 1; transform: scale(1); }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .loader-logo {
                width: 120px;
                height: 120px;
            }
            .loader-brain {
                font-size: 2rem;
            }
            .loader-text {
                font-size: 1.25rem;
            }
            .loader-progress-container {
                width: 220px;
            }
            .loader-skills {
                max-width: 240px;
            }
            .loader-pulse-ring:nth-child(1) { width: 60px; height: 60px; }
            .loader-pulse-ring:nth-child(2) { width: 80px; height: 80px; }
            .loader-pulse-ring:nth-child(3) { width: 100px; height: 100px; }
        }
    </style>
</head>
<body>
    <!-- Page Loader - Neural Mind Awakening -->
    <div class="page-loader" id="page-loader">
        <div class="loader-content">
            <div class="loader-logo">
                <!-- Pulsing glow rings -->
                <div class="loader-pulse-ring"></div>
                <div class="loader-pulse-ring"></div>
                <div class="loader-pulse-ring"></div>

                <!-- Neural Network SVG -->
                <div class="loader-neural">
                    <svg viewBox="0 0 100 100">
                        <defs>
                            <filter id="neuralGlow" x="-50%" y="-50%" width="200%" height="200%">
                                <feGaussianBlur stdDeviation="2" result="blur"/>
                                <feMerge>
                                    <feMergeNode in="blur"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>
                        <!-- Neural nodes -->
                        <circle class="neural-node" cx="50" cy="20" r="4" filter="url(#neuralGlow)"/>
                        <circle class="neural-node cyan" cx="25" cy="40" r="3" filter="url(#neuralGlow)"/>
                        <circle class="neural-node" cx="75" cy="40" r="3" filter="url(#neuralGlow)"/>
                        <circle class="neural-node purple" cx="20" cy="65" r="3" filter="url(#neuralGlow)"/>
                        <circle class="neural-node cyan" cx="50" cy="55" r="5" filter="url(#neuralGlow)"/>
                        <circle class="neural-node" cx="80" cy="65" r="3" filter="url(#neuralGlow)"/>
                        <circle class="neural-node purple" cx="50" cy="85" r="4" filter="url(#neuralGlow)"/>
                        <!-- Synaptic connections -->
                        <line class="synapse-line" x1="50" y1="20" x2="25" y2="40"/>
                        <line class="synapse-line" x1="50" y1="20" x2="75" y2="40"/>
                        <line class="synapse-line" x1="25" y1="40" x2="50" y2="55"/>
                        <line class="synapse-line" x1="75" y1="40" x2="50" y2="55"/>
                        <line class="synapse-line" x1="50" y1="55" x2="20" y2="65"/>
                        <line class="synapse-line" x1="50" y1="55" x2="80" y2="65"/>
                        <line class="synapse-line" x1="50" y1="55" x2="50" y2="85"/>
                    </svg>
                </div>

                <!-- Central brain emoji -->
                <span class="loader-brain">ðŸ§ </span>
            </div>
            <div class="loader-text">Carlos Orbegoso</div>
            <div class="loader-role">Backend Developer</div>
            <div class="loader-progress-container">
                <div class="loader-progress-label">
                    <span class="loader-status">Initializing</span>
                    <span class="loader-progress-value">0%</span>
                </div>
                <div class="loader-progress">
                    <div class="loader-progress-bar" id="loader-progress-bar"></div>
                </div>
            </div>
            <div class="loader-skills">
                <span class="loader-skill">Java</span>
                <span class="loader-skill">Spring</span>
                <span class="loader-skill">Quarkus</span>
                <span class="loader-skill">Cloud</span>
            </div>
        </div>
    </div>
    <!-- Neural Background Container (Global) -->
    <div id="neural-background-container" class="neural-background-container"></div>

    <!-- Contenedor para efectos visuales Three.js -->
    <div id="visual-effects-container" class="visual-effects-container"></div>

    <!-- Main Content -->
    <slot />

    <!-- Scripts de inicializaciÃ³n -->
    <script>
        import '../styles/main.css';
        import { Portfolio } from '../scripts/core/Portfolio.js';
        import { LoaderProgress } from '../scripts/core/LoaderProgress.js';
        import { initWebVitals } from '../scripts/utils/web-vitals.js';

        // Initialize Web Vitals tracking
        initWebVitals();

        const loaderProgress = new LoaderProgress();

        // Simulate initial progress
        setTimeout(() => loaderProgress.updateProgress(15), 100);
        setTimeout(() => loaderProgress.updateProgress(35), 400);
        setTimeout(() => loaderProgress.updateProgress(55), 800);

        // Hide loader when page is ready
        const hideLoader = () => {
            loaderProgress.complete();
            setTimeout(() => loaderProgress.hide(), 400);
        };

        // Setup scroll progress indicator
        const setupScrollProgress = () => {
            const progressBar = document.querySelector('[data-header-progress]');
            if (!progressBar) return;

            window.addEventListener('scroll', () => {
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercent = (scrollTop / docHeight) * 100;
                progressBar.style.width = `${scrollPercent}%`;
            });
        };

        // Setup contact form
        const setupContactForm = () => {
            const form = document.getElementById('contact-form');
            if (!form) return;

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const submitBtn = form.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;

                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
                submitBtn.disabled = true;

                await new Promise(resolve => setTimeout(resolve, 1500));

                submitBtn.innerHTML = '<i class="fas fa-check"></i> Sent!';
                form.reset();

                setTimeout(() => {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }, 2000);
            });
        };

        document.addEventListener('DOMContentLoaded', async () => {
            loaderProgress.updateProgress(60);

            const portfolio = new Portfolio();

            loaderProgress.updateProgress(75);
            await portfolio.init();
            loaderProgress.updateProgress(90);

            window.portfolio = portfolio;

            setupScrollProgress();
            setupContactForm();

            loaderProgress.updateProgress(100);
            setTimeout(hideLoader, 600);
        });

        // Fallback: hide loader after max wait time
        window.addEventListener('load', () => {
            if (!loaderProgress.isComplete) {
                loaderProgress.updateProgress(100);
                setTimeout(hideLoader, 800);
            }
        });
    </script>
</body>
</html>
