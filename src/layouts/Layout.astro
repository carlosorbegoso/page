---
interface Props {
  title?: string;
  description?: string;
}

const {
  title = "Carlos Orbegoso - Backend Developer & Java Specialist",
  description = "Backend Developer especializado en Java, Spring Boot y Quarkus. Experiencia en microservicios y arquitecturas cloud."
} = Astro.props;
---

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#64B5F6">
    <title>{title}</title>
    <meta name="description" content={description}>

    <!-- SEO Meta Tags -->
    <meta name="author" content="Carlos Orbegoso">
    <meta name="keywords" content="Backend Developer, Java, Spring Boot, Quarkus, Microservices, Cloud Native, Software Engineer">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://carlosorbegoso.dev">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://carlosorbegoso.dev">
    <meta property="og:title" content={title}>
    <meta property="og:description" content={description}>
    <meta property="og:image" content="https://carlosorbegoso.dev/og-image.jpg">
    <meta property="og:locale" content="es_ES">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://carlosorbegoso.dev">
    <meta name="twitter:title" content={title}>
    <meta name="twitter:description" content={description}>
    <meta name="twitter:image" content="https://carlosorbegoso.dev/og-image.jpg">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.svg">

    <!-- Structured Data / JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Carlos Orbegoso",
        "url": "https://carlosorbegoso.dev",
        "image": "https://carlosorbegoso.dev/og-image.jpg",
        "jobTitle": "Backend Developer",
        "worksFor": {
            "@type": "Organization",
            "name": "Tata Consultancy Services"
        },
        "sameAs": [
            "https://github.com/carlosorbegoso",
            "https://linkedin.com/in/carlos-orbergoso-loayza"
        ],
        "knowsAbout": ["Java", "Spring Boot", "Quarkus", "Microservices", "Cloud Native", "Backend Development"]
    }
    </script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Loader styles -->
    <style>
        .page-loader {
            position: fixed;
            inset: 0;
            background: #0a0a0f;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            overflow: hidden;
        }

        .page-loader::before {
            content: '';
            position: absolute;
            width: 150%;
            height: 150%;
            background: radial-gradient(circle at 30% 30%, rgba(100, 181, 246, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 70% 70%, rgba(255, 107, 53, 0.06) 0%, transparent 50%);
            animation: loaderBgPulse 4s ease-in-out infinite;
        }

        @keyframes loaderBgPulse {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.1) rotate(180deg); opacity: 0.8; }
        }

        .page-loader.loaded {
            animation: loaderExit 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes loaderExit {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0; transform: scale(0.9); visibility: hidden; }
        }

        .loader-content {
            text-align: center;
            position: relative;
            z-index: 1;
        }

        /* Logo con c贸digo animado */
        .loader-logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 2.5rem;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Hex谩gono de fondo */
        .loader-hexagon {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .loader-hexagon svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 20px rgba(100, 181, 246, 0.3));
        }

        .hex-path {
            fill: none;
            stroke: url(#hexGradient);
            stroke-width: 2;
            stroke-dasharray: 400;
            stroke-dashoffset: 400;
            animation: hexDraw 2s ease-out forwards;
        }

        @keyframes hexDraw {
            to { stroke-dashoffset: 0; }
        }

        /* Part铆culas orbitando */
        .loader-orbit {
            position: absolute;
            width: 140px;
            height: 140px;
            border-radius: 50%;
            animation: orbitSpin 3s linear infinite;
        }

        .loader-orbit::before,
        .loader-orbit::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, #64B5F6, #00ffff);
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(100, 181, 246, 0.8);
        }

        .loader-orbit::before {
            top: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .loader-orbit::after {
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #FF6B35, #ff9966);
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.8);
        }

        .loader-orbit-2 {
            width: 100px;
            height: 100px;
            animation: orbitSpin 2s linear infinite reverse;
        }

        .loader-orbit-2::before {
            width: 6px;
            height: 6px;
            background: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }

        .loader-orbit-2::after {
            width: 6px;
            height: 6px;
            background: #aa44ff;
            box-shadow: 0 0 10px rgba(170, 68, 255, 0.8);
        }

        @keyframes orbitSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Icono central con efecto de c贸digo */
        .loader-code {
            position: relative;
            z-index: 2;
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #64B5F6, #00ffff, #FF6B35);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: codeGradient 2s ease infinite, codePulse 1.5s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(100, 181, 246, 0.5);
        }

        @keyframes codeGradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes codePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Texto con typing effect */
        .loader-text {
            color: #ffffff;
            font-family: 'Inter', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: 0.05em;
            opacity: 0;
            animation: fadeInUp 0.6s ease forwards 0.5s;
        }

        .loader-role {
            display: inline-block;
            color: transparent;
            background: linear-gradient(90deg, #64B5F6, #FF6B35);
            -webkit-background-clip: text;
            background-clip: text;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0;
            animation: fadeInUp 0.6s ease forwards 0.8s;
        }

        .loader-role::after {
            content: '|';
            color: #64B5F6;
            animation: blink 1s step-end infinite;
            margin-left: 2px;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Progress bar moderna */
        .loader-progress-container {
            width: 280px;
            margin-top: 2.5rem;
            opacity: 0;
            animation: fadeInUp 0.6s ease forwards 1s;
        }

        .loader-progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: #666;
        }

        .loader-progress-value {
            color: #64B5F6;
        }

        .loader-progress {
            width: 100%;
            height: 3px;
            background: rgba(100, 181, 246, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .loader-progress::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(100, 181, 246, 0.1) 50%,
                transparent 100%
            );
            animation: progressShine 1.5s ease infinite;
        }

        @keyframes progressShine {
            from { transform: translateX(-100%); }
            to { transform: translateX(100%); }
        }

        .loader-progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #64B5F6, #00ffff, #FF6B35);
            background-size: 200% 100%;
            border-radius: 10px;
            animation: progressGradient 1s ease infinite;
            box-shadow: 0 0 10px rgba(100, 181, 246, 0.5);
            transition: width 0.3s ease-out;
        }

        @keyframes progressGradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Skills que se cargan */
        .loader-skills {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            margin-top: 1.5rem;
            flex-wrap: wrap;
            max-width: 300px;
        }

        .loader-skill {
            padding: 0.3rem 0.75rem;
            background: rgba(100, 181, 246, 0.05);
            border: 1px solid rgba(100, 181, 246, 0.15);
            border-radius: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            color: #888;
            opacity: 0;
            transform: scale(0.8);
        }

        .loader-skill:nth-child(1) { animation: skillPop 0.4s ease forwards 1.2s; }
        .loader-skill:nth-child(2) { animation: skillPop 0.4s ease forwards 1.4s; }
        .loader-skill:nth-child(3) { animation: skillPop 0.4s ease forwards 1.6s; }
        .loader-skill:nth-child(4) { animation: skillPop 0.4s ease forwards 1.8s; }

        @keyframes skillPop {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .loader-logo {
                width: 100px;
                height: 100px;
            }
            .loader-orbit {
                width: 120px;
                height: 120px;
            }
            .loader-orbit-2 {
                width: 80px;
                height: 80px;
            }
            .loader-code {
                font-size: 1.5rem;
            }
            .loader-text {
                font-size: 1.25rem;
            }
            .loader-progress-container {
                width: 220px;
            }
            .loader-skills {
                max-width: 240px;
            }
        }

        /* Custom Cursor */
        .custom-cursor {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 99999;
            mix-blend-mode: difference;
        }

        .cursor-dot {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #fff;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: transform 0.1s ease, width 0.2s ease, height 0.2s ease;
        }

        .cursor-outline {
            position: absolute;
            width: 40px;
            height: 40px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: transform 0.15s ease-out, width 0.2s ease, height 0.2s ease, border-color 0.2s ease;
        }

        .custom-cursor.hover .cursor-dot {
            transform: translate(-50%, -50%) scale(2);
            background: #64B5F6;
        }

        .custom-cursor.hover .cursor-outline {
            transform: translate(-50%, -50%) scale(1.5);
            border-color: #64B5F6;
            border-width: 1px;
        }

        .custom-cursor.clicking .cursor-dot {
            transform: translate(-50%, -50%) scale(0.5);
        }

        .custom-cursor.clicking .cursor-outline {
            transform: translate(-50%, -50%) scale(0.8);
        }

        /* Hide on touch devices */
        @media (hover: none) and (pointer: coarse) {
            .custom-cursor {
                display: none;
            }
        }

        /* Hide default cursor on desktop when custom cursor is active */
        @media (hover: hover) and (pointer: fine) {
            body {
                cursor: none;
            }
            a, button, .btn, .nav-link, .project-card, .stat-card, .tech-tag, .social-link, .floating-icon {
                cursor: none;
            }
        }
    </style>
</head>
<body>
    <!-- Custom Cursor -->
    <div class="custom-cursor" id="custom-cursor">
        <div class="cursor-dot"></div>
        <div class="cursor-outline"></div>
    </div>

    <!-- Page Loader -->
    <div class="page-loader" id="page-loader">
        <div class="loader-content">
            <div class="loader-logo">
                <!-- Hex谩gono animado -->
                <div class="loader-hexagon">
                    <svg viewBox="0 0 100 100">
                        <defs>
                            <linearGradient id="hexGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#64B5F6"/>
                                <stop offset="50%" style="stop-color:#00ffff"/>
                                <stop offset="100%" style="stop-color:#FF6B35"/>
                            </linearGradient>
                        </defs>
                        <polygon class="hex-path" points="50,5 90,27.5 90,72.5 50,95 10,72.5 10,27.5"/>
                    </svg>
                </div>
                <!-- rbitas con part铆culas -->
                <div class="loader-orbit"></div>
                <div class="loader-orbit loader-orbit-2"></div>
                <!-- C贸digo central -->
                <span class="loader-code">&lt;/&gt;</span>
            </div>
            <div class="loader-text">Carlos Orbegoso</div>
            <div class="loader-role">Backend Developer</div>
            <div class="loader-progress-container">
                <div class="loader-progress-label">
                    <span class="loader-status">Initializing</span>
                    <span class="loader-progress-value">0%</span>
                </div>
                <div class="loader-progress">
                    <div class="loader-progress-bar" id="loader-progress-bar"></div>
                </div>
            </div>
            <div class="loader-skills">
                <span class="loader-skill">Java</span>
                <span class="loader-skill">Spring</span>
                <span class="loader-skill">Quarkus</span>
                <span class="loader-skill">Cloud</span>
            </div>
        </div>
    </div>
    <!-- Contenedor para efectos visuales Three.js -->
    <div id="visual-effects-container" class="visual-effects-container"></div>

    <!-- Main Content -->
    <slot />

    <!-- Scripts de inicializaci贸n -->
    <script>
        import '../styles/main.css';
        import { CONFIG } from '../scripts/config/config.js';
        import { log } from '../scripts/utils/logger.js';
        import { DOM, Events, Performance } from '../scripts/utils/helpers.js';
        import { VisualEffectsEngine } from '../scripts/engines/visual-effects-engine.js';
        import { NeuralSystemEngine } from '../scripts/engines/neural-system/NeuralSystemEngine.js';
        import { HeroThreeEngine } from '../scripts/engines/hero-three-engine.js';
        import { HeaderAuroraEngine } from '../scripts/engines/header-aurora-engine.js';
        import { SkillsThreeEngine } from '../scripts/engines/skills-three-engine.js';
        import { AboutThreeEngine } from '../scripts/engines/about-three-engine.js';
        import { DeviceDetector } from '../scripts/utils/device-detector.js';
        import { MobileMenuManager } from '../scripts/utils/mobile-menu.js';
        import { HeroAnimations } from '../scripts/utils/hero-animations.js';
        import { AboutAnimations } from '../scripts/utils/about-animations.js';
        import { CursorParticlesEngine } from '../scripts/engines/cursor-particles-engine.js';

        class Portfolio {
            constructor() {
                this.isInitialized = false;
                this.modules = new Map();
                this.visualEngine = null;
                this.brainEngine = null;
                this.heroEngine = null;
                this.headerAuroraEngine = null;
                this.skillsEngine = null;
                this.aboutEngine = null;
                this.cursorEngine = null;
                this.deviceDetector = null;
                this.mobileMenuManager = null;
                this.heroAnimations = null;
                this.aboutAnimations = null;
            }

            async init() {
                try {
                    await this.initializeBasicModules();
                    this.setupBasicFeatures();
                    await this.initializeAdvancedModules();
                    this.setupGlobalEvents();
                    this.isInitialized = true;
                    log.info('Portfolio inicializado');
                } catch (error) {
                    console.error('Error inicializando portfolio:', error);
                }
            }

            async initializeBasicModules() {
                this.deviceDetector = new DeviceDetector();
                this.mobileMenuManager = new MobileMenuManager();
                this.heroAnimations = new HeroAnimations();
                this.aboutAnimations = new AboutAnimations();
            }

            async initializeAdvancedModules() {
                try {
                    this.visualEngine = new VisualEffectsEngine();
                    const currentTheme = localStorage.getItem('theme') || CONFIG.THEMES.DEFAULT;
                    this.visualEngine.updateTheme(currentTheme);
                    this.initializeSectionEffects();
                } catch (error) {
                    log.error('Error inicializando motor visual:', error);
                }

                try {
                    this.heroEngine = new HeroThreeEngine();
                    await this.heroEngine.init('hero-particles');
                } catch (error) {
                    log.error('Error inicializando Hero Three.js Engine:', error);
                }

                // Inicializar cerebro anat贸mico 茅pico como fondo
                try {
                    console.log('Creando NeuralSystemEngine (Cerebro Anat贸mico pico)...');
                    this.brainEngine = new NeuralSystemEngine('visual-effects-container');
                } catch (error) {
                    console.error('Error creando cerebro 茅pico:', error);
                }

                // Inicializar Header Aurora Engine (efectos espaciales/aurora)
                try {
                    this.headerAuroraEngine = new HeaderAuroraEngine();
                    await this.headerAuroraEngine.init('header-aurora-container');
                    const currentTheme = localStorage.getItem('theme') || CONFIG.THEMES.DEFAULT;
                    this.headerAuroraEngine.updateTheme(currentTheme);
                    console.log('Header Aurora Engine initialized');
                } catch (error) {
                    console.error('Error initializing Header Aurora Engine:', error);
                }

                // Inicializar Skills Three.js Engine
                try {
                    this.skillsEngine = new SkillsThreeEngine();
                    await this.skillsEngine.init('skills-three-container');
                    const currentTheme = localStorage.getItem('theme') || CONFIG.THEMES.DEFAULT;
                    this.skillsEngine.updateTheme(currentTheme);
                    console.log('Skills Three.js Engine initialized');
                } catch (error) {
                    console.error('Error initializing Skills Three.js Engine:', error);
                }

                // Inicializar About Three.js Engine
                try {
                    this.aboutEngine = new AboutThreeEngine();
                    await this.aboutEngine.init('about-three-container');
                    const currentTheme = localStorage.getItem('theme') || CONFIG.THEMES.DEFAULT;
                    this.aboutEngine.updateTheme(currentTheme);
                    console.log('About Three.js Engine initialized');
                } catch (error) {
                    console.error('Error initializing About Three.js Engine:', error);
                }
            }

            initializeSectionEffects() {
                if (!this.visualEngine) return;

                const sections = [
                    { name: 'Hero', containerId: 'hero-effects' },
                    { name: 'About', containerId: 'about-effects' },
                    { name: 'Experience', containerId: 'experience-effects' },
                    { name: 'Skills', containerId: 'skills-effects' },
                    { name: 'Projects', containerId: 'projects-effects' },
                    { name: 'Contact', containerId: 'contact-effects' }
                ];

                sections.forEach(section => {
                    const sectionElement = document.getElementById(section.name.toLowerCase());
                    if (sectionElement) {
                        this.visualEngine.initSectionEffects(section.name, section.containerId);
                    }
                });

                this.setupSectionEffectsObserver();
            }

            setupSectionEffectsObserver() {
                const sections = ['hero', 'about', 'experience', 'skills', 'projects', 'contact'];

                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('section-effects-active');
                        }
                    });
                }, { threshold: 0.1, rootMargin: '0px 0px -100px 0px' });

                sections.forEach(sectionId => {
                    const section = document.getElementById(sectionId);
                    if (section) observer.observe(section);
                });
            }

            setupBasicFeatures() {
                this.setupThemeToggle();
                this.setupMobileMenu();
                this.setupSmoothScrolling();
                this.setupLanguageToggle();
                this.setupMobileOptimizations();
                this.setupTouchInteractions();
            }

            setupThemeToggle() {
                const themeToggle = DOM.select('#theme-toggle');
                if (!themeToggle) return;

                const currentTheme = localStorage.getItem('theme') || CONFIG.THEMES.DEFAULT;
                document.documentElement.setAttribute('data-theme', currentTheme);
                this.updateThemeIcon(currentTheme);

                Events.on(themeToggle, 'click', () => {
                    const newTheme = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                    this.updateThemeIcon(newTheme);

                    if (this.visualEngine) this.visualEngine.updateTheme(newTheme);
                    if (this.heroEngine) this.heroEngine.updateTheme(newTheme);
                    if (this.headerAuroraEngine) this.headerAuroraEngine.updateTheme(newTheme);
                    if (this.skillsEngine) this.skillsEngine.updateTheme(newTheme);
                    if (this.aboutEngine) this.aboutEngine.updateTheme(newTheme);

                    Events.trigger(window, 'themeChanged', { theme: newTheme });
                });
            }

            updateThemeIcon(theme) {
                const themeIcon = DOM.select('#theme-toggle i');
                if (themeIcon) {
                    themeIcon.className = theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
                }
            }

            setupMobileMenu() {
                const menuToggle = DOM.select('#menu-toggle');
                const navLinks = DOM.select('.nav-links');
                if (!menuToggle || !navLinks) return;

                Events.on(menuToggle, 'click', () => {
                    DOM.toggleClass(navLinks, 'active');
                    DOM.toggleClass(menuToggle, 'active');
                    document.body.style.overflow = navLinks.classList.contains('active') ? 'hidden' : '';
                });

                DOM.selectAll('.nav-link').forEach(link => {
                    Events.on(link, 'click', () => {
                        DOM.removeClasses(navLinks, 'active');
                        DOM.removeClasses(menuToggle, 'active');
                        document.body.style.overflow = '';
                    });
                });

                Events.on(document, 'click', (e) => {
                    if (!menuToggle.contains(e.target) && !navLinks.contains(e.target)) {
                        DOM.removeClasses(navLinks, 'active');
                        DOM.removeClasses(menuToggle, 'active');
                        document.body.style.overflow = '';
                    }
                });
            }

            setupSmoothScrolling() {
                DOM.selectAll('a[href^="#"]').forEach(anchor => {
                    Events.on(anchor, 'click', (e) => {
                        e.preventDefault();
                        const target = DOM.select(anchor.getAttribute('href'));
                        if (target) {
                            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    });
                });
            }

            setupLanguageToggle() {
                const languageToggle = DOM.select('#language-toggle');
                if (!languageToggle) return;

                const currentLanguage = localStorage.getItem('language') || CONFIG.LANGUAGES.DEFAULT;
                document.documentElement.setAttribute('data-language', currentLanguage);

                Events.on(languageToggle, 'click', () => {
                    const newLanguage = localStorage.getItem('language') === 'en' ? 'es' : 'en';
                    localStorage.setItem('language', newLanguage);
                    document.documentElement.setAttribute('data-language', newLanguage);
                    Events.trigger(window, 'languageChanged', { language: newLanguage });
                });
            }

            setupMobileOptimizations() {
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                if (isMobile) DOM.addClasses(document.body, 'mobile-device');

                const isTablet = window.innerWidth <= CONFIG.BREAKPOINTS.TABLET && window.innerWidth > CONFIG.BREAKPOINTS.MOBILE;
                if (isTablet) DOM.addClasses(document.body, 'tablet-device');
            }

            setupTouchInteractions() {
                const interactiveElements = DOM.selectAll('.btn, .tech-badge, .nav-link, .card');
                interactiveElements.forEach(element => {
                    Events.on(element, 'touchstart', () => { element.style.transform = 'scale(0.95)'; });
                    Events.on(element, 'touchend', () => { element.style.transform = ''; });
                    Events.on(element, 'touchcancel', () => { element.style.transform = ''; });
                });
            }

            setupGlobalEvents() {
                Events.on(document, 'visibilitychange', () => {
                    // Pausar/reanudar animaciones seg煤n visibilidad
                });

                Events.on(window, 'resize', Performance.throttle(() => {
                    // Manejar resize
                }, 100));

                // Konami Code Easter Egg: BA
                const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
                let konamiIndex = 0;

                Events.on(document, 'keydown', (e) => {
                    if (e.key === 'Escape') {
                        const navLinks = DOM.select('.nav-links');
                        const menuToggle = DOM.select('#menu-toggle');
                        if (navLinks?.classList.contains('active')) {
                            DOM.removeClasses(navLinks, 'active');
                            DOM.removeClasses(menuToggle, 'active');
                        }
                    }
                    if (e.key === 't' && e.ctrlKey) {
                        e.preventDefault();
                        DOM.select('#theme-toggle')?.click();
                    }

                    // Konami Code detection
                    if (e.key === konamiCode[konamiIndex]) {
                        konamiIndex++;
                        if (konamiIndex === konamiCode.length) {
                            this.activateKonamiEasterEgg();
                            konamiIndex = 0;
                        }
                    } else {
                        konamiIndex = 0;
                    }
                });
            }

            activateKonamiEasterEgg() {
                // Create epic overlay
                const overlay = document.createElement('div');
                overlay.className = 'konami-overlay';
                overlay.innerHTML = `
                    <div class="konami-content">
                        <div class="konami-icon"></div>
                        <h2 class="konami-title">Achievement Unlocked!</h2>
                        <p class="konami-text">You found the secret Konami Code!</p>
                        <div class="konami-badges">
                            <span class="konami-badge">+30 Lives</span>
                            <span class="konami-badge">God Mode</span>
                            <span class="konami-badge">All Weapons</span>
                        </div>
                        <p class="konami-signature">~ Carlos Orbegoso, Backend Developer & Gamer ~</p>
                    </div>
                `;
                document.body.appendChild(overlay);

                // Add styles dynamically
                const style = document.createElement('style');
                style.textContent = `
                    .konami-overlay {
                        position: fixed;
                        inset: 0;
                        background: rgba(0, 0, 0, 0.95);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        z-index: 99999;
                        animation: konamiFadeIn 0.5s ease;
                    }
                    @keyframes konamiFadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    .konami-content {
                        text-align: center;
                        animation: konamiSlideUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
                    }
                    @keyframes konamiSlideUp {
                        from { opacity: 0; transform: translateY(50px) scale(0.9); }
                        to { opacity: 1; transform: translateY(0) scale(1); }
                    }
                    .konami-icon {
                        font-size: 5rem;
                        animation: konamiPulse 1s ease infinite;
                        margin-bottom: 1.5rem;
                    }
                    @keyframes konamiPulse {
                        0%, 100% { transform: scale(1); }
                        50% { transform: scale(1.2); }
                    }
                    .konami-title {
                        font-family: 'Poppins', sans-serif;
                        font-size: 2.5rem;
                        font-weight: 800;
                        background: linear-gradient(90deg, #FFD700, #FF6B35, #00FFFF, #64B5F6);
                        background-size: 300% 300%;
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                        animation: konamiGradient 2s ease infinite;
                        margin-bottom: 1rem;
                    }
                    @keyframes konamiGradient {
                        0%, 100% { background-position: 0% 50%; }
                        50% { background-position: 100% 50%; }
                    }
                    .konami-text {
                        color: #ccc;
                        font-size: 1.1rem;
                        margin-bottom: 2rem;
                    }
                    .konami-badges {
                        display: flex;
                        gap: 1rem;
                        justify-content: center;
                        flex-wrap: wrap;
                        margin-bottom: 2rem;
                    }
                    .konami-badge {
                        padding: 0.5rem 1rem;
                        background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 107, 53, 0.2));
                        border: 1px solid rgba(255, 215, 0, 0.5);
                        border-radius: 20px;
                        color: #FFD700;
                        font-family: 'JetBrains Mono', monospace;
                        font-size: 0.85rem;
                        animation: konamiBadgePop 0.5s ease backwards;
                    }
                    .konami-badge:nth-child(1) { animation-delay: 0.3s; }
                    .konami-badge:nth-child(2) { animation-delay: 0.5s; }
                    .konami-badge:nth-child(3) { animation-delay: 0.7s; }
                    @keyframes konamiBadgePop {
                        from { opacity: 0; transform: scale(0); }
                        to { opacity: 1; transform: scale(1); }
                    }
                    .konami-signature {
                        color: #666;
                        font-style: italic;
                        font-size: 0.9rem;
                    }
                    @keyframes konamiFadeOut {
                        from { opacity: 1; }
                        to { opacity: 0; }
                    }
                `;
                document.head.appendChild(style);

                // Play retro sound effect
                try {
                    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioCtx.createOscillator();
                    const gainNode = audioCtx.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(audioCtx.destination);
                    oscillator.frequency.setValueAtTime(587.33, audioCtx.currentTime);
                    oscillator.frequency.setValueAtTime(880, audioCtx.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(1174.66, audioCtx.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.5);
                } catch (e) {}

                // Remove overlay on click
                overlay.addEventListener('click', () => {
                    overlay.style.animation = 'konamiFadeOut 0.3s ease forwards';
                    setTimeout(() => {
                        overlay.remove();
                        style.remove();
                    }, 300);
                });

                // Auto-close after 5 seconds
                setTimeout(() => {
                    if (document.body.contains(overlay)) {
                        overlay.click();
                    }
                }, 5000);
            }
        }

        // Loader progress management
        class LoaderProgress {
            constructor() {
                this.progressBar = document.getElementById('loader-progress-bar');
                this.progressValue = document.querySelector('.loader-progress-value');
                this.statusText = document.querySelector('.loader-status');
                this.currentProgress = 0;
                this.targetProgress = 0;
                this.isComplete = false;
                this.stages = [
                    { progress: 15, status: 'Loading assets...' },
                    { progress: 35, status: 'Initializing...' },
                    { progress: 55, status: 'Loading modules...' },
                    { progress: 75, status: 'Preparing UI...' },
                    { progress: 90, status: 'Almost ready...' },
                    { progress: 100, status: 'Complete!' }
                ];
            }

            updateProgress(progress) {
                this.targetProgress = Math.min(progress, 100);
                this.animateProgress();
            }

            animateProgress() {
                if (this.currentProgress < this.targetProgress) {
                    this.currentProgress += Math.max(1, (this.targetProgress - this.currentProgress) * 0.1);

                    if (this.currentProgress >= this.targetProgress - 0.5) {
                        this.currentProgress = this.targetProgress;
                    }

                    const roundedProgress = Math.round(this.currentProgress);

                    if (this.progressBar) {
                        this.progressBar.style.width = `${roundedProgress}%`;
                    }
                    if (this.progressValue) {
                        this.progressValue.textContent = `${roundedProgress}%`;
                    }

                    // Update status text based on progress
                    this.updateStatus(roundedProgress);

                    if (this.currentProgress < this.targetProgress) {
                        requestAnimationFrame(() => this.animateProgress());
                    }
                }
            }

            updateStatus(progress) {
                if (!this.statusText) return;

                for (let i = this.stages.length - 1; i >= 0; i--) {
                    if (progress >= this.stages[i].progress - 10) {
                        this.statusText.textContent = this.stages[i].status;
                        break;
                    }
                }
            }

            complete() {
                this.isComplete = true;
                this.updateProgress(100);
            }
        }

        const loaderProgress = new LoaderProgress();

        // Simulate initial progress
        setTimeout(() => loaderProgress.updateProgress(15), 100);
        setTimeout(() => loaderProgress.updateProgress(35), 400);
        setTimeout(() => loaderProgress.updateProgress(55), 800);

        // Hide loader when page is ready
        const hideLoader = () => {
            loaderProgress.complete();

            setTimeout(() => {
                const loader = document.getElementById('page-loader');
                if (loader) {
                    loader.classList.add('loaded');
                    setTimeout(() => {
                        loader.style.display = 'none';
                    }, 800);
                }
            }, 400);
        };

        // Setup scroll progress indicator
        const setupScrollProgress = () => {
            const progressBar = document.querySelector('[data-header-progress]');
            if (!progressBar) return;

            window.addEventListener('scroll', () => {
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercent = (scrollTop / docHeight) * 100;
                progressBar.style.width = `${scrollPercent}%`;
            });
        };

        // Setup contact form
        const setupContactForm = () => {
            const form = document.getElementById('contact-form');
            if (!form) return;

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const submitBtn = form.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;

                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
                submitBtn.disabled = true;

                // Simulate form submission (replace with actual endpoint)
                await new Promise(resolve => setTimeout(resolve, 1500));

                submitBtn.innerHTML = '<i class="fas fa-check"></i> Sent!';
                form.reset();

                setTimeout(() => {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }, 2000);
            });
        };

        document.addEventListener('DOMContentLoaded', async () => {
            loaderProgress.updateProgress(60);

            const portfolio = new Portfolio();

            // Update progress during initialization
            loaderProgress.updateProgress(75);
            await portfolio.init();
            loaderProgress.updateProgress(90);

            window.portfolio = portfolio;

            setupScrollProgress();
            setupContactForm();

            // Hide loader after everything is initialized
            loaderProgress.updateProgress(100);
            setTimeout(hideLoader, 600);
        });

        // Fallback: hide loader after max wait time
        window.addEventListener('load', () => {
            if (!loaderProgress.isComplete) {
                loaderProgress.updateProgress(100);
                setTimeout(hideLoader, 800);
            }
        });

        // Custom Cursor
        const setupCustomCursor = () => {
            const cursor = document.getElementById('custom-cursor');
            if (!cursor) return;

            const cursorDot = cursor.querySelector('.cursor-dot');
            const cursorOutline = cursor.querySelector('.cursor-outline');

            let mouseX = 0, mouseY = 0;
            let outlineX = 0, outlineY = 0;

            // Update cursor position
            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;

                // Move dot immediately
                if (cursorDot) {
                    cursorDot.style.left = mouseX + 'px';
                    cursorDot.style.top = mouseY + 'px';
                }
            });

            // Smooth outline follow
            const animateOutline = () => {
                outlineX += (mouseX - outlineX) * 0.15;
                outlineY += (mouseY - outlineY) * 0.15;

                if (cursorOutline) {
                    cursorOutline.style.left = outlineX + 'px';
                    cursorOutline.style.top = outlineY + 'px';
                }

                requestAnimationFrame(animateOutline);
            };
            animateOutline();

            // Hover effect on interactive elements
            const interactiveElements = document.querySelectorAll('a, button, .btn, .nav-link, .project-card, .stat-card, .tech-tag, .social-link, .floating-icon, input, textarea, select');

            interactiveElements.forEach(el => {
                el.addEventListener('mouseenter', () => cursor.classList.add('hover'));
                el.addEventListener('mouseleave', () => cursor.classList.remove('hover'));
            });

            // Click effect
            document.addEventListener('mousedown', () => cursor.classList.add('clicking'));
            document.addEventListener('mouseup', () => cursor.classList.remove('clicking'));

            // Hide when leaving window
            document.addEventListener('mouseleave', () => cursor.style.opacity = '0');
            document.addEventListener('mouseenter', () => cursor.style.opacity = '1');
        };

        // Initialize cursor after DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', setupCustomCursor);
        } else {
            setupCustomCursor();
        }
    </script>
</body>
</html>
