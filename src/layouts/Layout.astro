---
interface Props {
  title?: string;
  description?: string;
  image?: string;
}

const siteUrl = 'https://carlosorbegoso.github.io/page';
const {
  title = "Carlos Orbegoso - Backend Developer & Java Specialist",
  description = "Backend Developer especializado en Java, Spring Boot y Quarkus. +5 años de experiencia en microservicios, APIs REST y arquitecturas cloud-native.",
  image = `${siteUrl}/images/og-image.jpg`
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, siteUrl);
---

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#64B5F6" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <title>{title}</title>
    <meta name="description" content={description}>

    <!-- SEO Meta Tags -->
    <meta name="author" content="Carlos Orbegoso">
    <meta name="keywords" content="Backend Developer, Java Developer, Spring Boot, Quarkus, Microservices, Cloud Native, Software Engineer, API REST, Lima Peru, Desarrollador Backend">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <link rel="canonical" href={canonicalURL}>

    <!-- Geo Tags for Local SEO -->
    <meta name="geo.region" content="PE-LIM">
    <meta name="geo.placename" content="Lima, Peru">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content={canonicalURL}>
    <meta property="og:title" content={title}>
    <meta property="og:description" content={description}>
    <meta property="og:image" content={image}>
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Carlos Orbegoso - Backend Developer Portfolio">
    <meta property="og:locale" content="es_PE">
    <meta property="og:locale:alternate" content="en_US">
    <meta property="og:site_name" content="Carlos Orbegoso Portfolio">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content={canonicalURL}>
    <meta name="twitter:title" content={title}>
    <meta name="twitter:description" content={description}>
    <meta name="twitter:image" content={image}>
    <meta name="twitter:creator" content="@carlosorbegoso">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href={`${import.meta.env.BASE_URL}/favicon.svg`}>
    <link rel="apple-touch-icon" sizes="180x180" href={`${import.meta.env.BASE_URL}/favicon.svg`}>

    <!-- PWA Manifest -->
    <link rel="manifest" href={`${import.meta.env.BASE_URL}/manifest.json`}>

    <!-- DNS Prefetch for external resources -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Structured Data / JSON-LD - Person -->
    <script is:inline type="application/ld+json" set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Carlos Orbegoso",
        "url": siteUrl,
        "image": image,
        "jobTitle": "Backend Developer",
        "description": description,
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "Lima",
            "addressCountry": "PE"
        },
        "worksFor": {
            "@type": "Organization",
            "name": "Tata Consultancy Services"
        },
        "sameAs": [
            "https://github.com/carlosorbegoso",
            "https://linkedin.com/in/carlos-orbergoso-loayza"
        ],
        "knowsAbout": ["Java", "Spring Boot", "Quarkus", "Microservices", "Cloud Native", "Backend Development", "REST API", "Docker", "Kubernetes", "AWS"]
    })} />

    <!-- Structured Data / JSON-LD - WebSite -->
    <script is:inline type="application/ld+json" set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Carlos Orbegoso Portfolio",
        "url": siteUrl,
        "description": description,
        "author": {
            "@type": "Person",
            "name": "Carlos Orbegoso"
        }
    })} />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Loader styles -->
    <style>
        /* ===== NEURAL MIND AWAKENING LOADER ===== */
        .page-loader {
            position: fixed;
            inset: 0;
            background: var(--mind-void, #030308);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            overflow: hidden;
        }

        /* Three.js canvas container */
        #loader-canvas-container {
            position: absolute;
            inset: 0;
            z-index: 0;
            pointer-events: none;
        }

        #loader-canvas-container canvas {
            width: 100% !important;
            height: 100% !important;
        }

        /* Neural glow background - subtle when Three.js is active */
        .page-loader::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background:
                radial-gradient(circle at 30% 40%, rgba(100, 181, 246, 0.04) 0%, transparent 40%),
                radial-gradient(circle at 70% 60%, rgba(0, 255, 255, 0.03) 0%, transparent 35%),
                radial-gradient(circle at 50% 50%, rgba(170, 68, 255, 0.02) 0%, transparent 50%);
            animation: neuralBgPulse 6s ease-in-out infinite;
        }

        @keyframes neuralBgPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
        }

        .page-loader.loaded {
            animation: loaderExit 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes loaderExit {
            0% { opacity: 1; }
            100% { opacity: 0; visibility: hidden; }
        }

        .loader-content {
            text-align: center;
            position: relative;
            z-index: 1;
            margin-top: 60px; /* Space for Three.js visualization above */
        }

        @keyframes pulseExpand {
            0% { transform: scale(0.8); opacity: 0.6; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        /* Central neural icon - SVG based */
        .loader-neural-icon {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            width: 120px;
            height: 120px;
            opacity: 0;
            animation: neuralFadeIn 1s ease forwards 0.2s;
        }

        @keyframes neuralFadeIn {
            to { opacity: 1; }
        }

        .neural-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 20px rgba(100, 181, 246, 0.5));
        }

        /* Rings */
        .neural-ring {
            fill: none;
            stroke-width: 0.5;
        }

        .neural-ring-outer {
            stroke: rgba(100, 181, 246, 0.2);
            animation: ringPulse 4s ease-in-out infinite;
        }

        .neural-ring-middle {
            stroke: rgba(0, 255, 255, 0.25);
            animation: ringPulse 4s ease-in-out infinite 0.5s;
        }

        .neural-ring-inner {
            stroke: rgba(170, 68, 255, 0.3);
            animation: ringPulse 4s ease-in-out infinite 1s;
        }

        @keyframes ringPulse {
            0%, 100% { opacity: 0.3; stroke-width: 0.5; }
            50% { opacity: 0.8; stroke-width: 1; }
        }

        /* Central core */
        .neural-core {
            fill: rgba(100, 181, 246, 0.3);
            stroke: rgba(100, 181, 246, 0.8);
            stroke-width: 1;
            animation: corePulse 2s ease-in-out infinite;
        }

        .neural-core-inner {
            fill: rgba(0, 255, 255, 0.6);
            animation: coreGlow 2s ease-in-out infinite;
        }

        @keyframes corePulse {
            0%, 100% {
                fill: rgba(100, 181, 246, 0.3);
                transform-origin: center;
                transform: scale(1);
            }
            50% {
                fill: rgba(100, 181, 246, 0.5);
                transform: scale(1.05);
            }
        }

        @keyframes coreGlow {
            0%, 100% { fill: rgba(0, 255, 255, 0.4); }
            50% { fill: rgba(0, 255, 255, 0.8); }
        }

        /* Neural nodes */
        .neural-node {
            fill: rgba(100, 181, 246, 0.6);
            stroke: rgba(0, 255, 255, 0.8);
            stroke-width: 1;
            opacity: 0;
            animation: nodeAppear 0.5s ease forwards;
        }

        .node-1 { animation-delay: 0.4s; }
        .node-2 { animation-delay: 0.6s; }
        .node-3 { animation-delay: 0.8s; }
        .node-4 { animation-delay: 1.0s; }
        .node-5 { animation-delay: 1.2s; }
        .node-6 { animation-delay: 1.4s; }

        @keyframes nodeAppear {
            0% { opacity: 0; transform: scale(0); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Synaptic connections */
        .synapse {
            stroke: rgba(0, 255, 255, 0.4);
            stroke-width: 1;
            stroke-linecap: round;
            opacity: 0;
            stroke-dasharray: 30;
            stroke-dashoffset: 30;
            animation: synapseConnect 0.8s ease forwards;
        }

        .synapse-1 { animation-delay: 0.5s; }
        .synapse-2 { animation-delay: 0.7s; }
        .synapse-3 { animation-delay: 0.9s; }
        .synapse-4 { animation-delay: 1.1s; }
        .synapse-5 { animation-delay: 1.3s; }
        .synapse-6 { animation-delay: 1.5s; }

        @keyframes synapseConnect {
            to {
                opacity: 1;
                stroke-dashoffset: 0;
            }
        }

        /* Pulse dots traveling along synapses */
        .pulse-dot {
            fill: rgba(255, 107, 53, 0.9);
            opacity: 0;
        }

        .pulse-1 {
            animation: pulsePath1 2s ease-in-out infinite 1.8s;
        }

        .pulse-2 {
            animation: pulsePath2 2s ease-in-out infinite 2.2s;
        }

        .pulse-3 {
            animation: pulsePath3 2s ease-in-out infinite 2.6s;
        }

        @keyframes pulsePath1 {
            0% { cx: 50; cy: 15; opacity: 0; }
            10% { opacity: 1; }
            50% { cx: 50; cy: 42; opacity: 1; }
            60% { opacity: 0; }
            100% { cx: 50; cy: 42; opacity: 0; }
        }

        @keyframes pulsePath2 {
            0% { cx: 80; cy: 35; opacity: 0; }
            10% { opacity: 1; }
            50% { cx: 58; cy: 46; opacity: 1; }
            60% { opacity: 0; }
            100% { cx: 58; cy: 46; opacity: 0; }
        }

        @keyframes pulsePath3 {
            0% { cx: 20; cy: 65; opacity: 0; }
            10% { opacity: 1; }
            50% { cx: 42; cy: 54; opacity: 1; }
            60% { opacity: 0; }
            100% { cx: 42; cy: 54; opacity: 0; }
        }

        /* Glow ring behind SVG */
        .neural-glow-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            height: 150px;
            background: radial-gradient(
                circle,
                rgba(100, 181, 246, 0.15) 0%,
                rgba(0, 255, 255, 0.08) 40%,
                transparent 70%
            );
            border-radius: 50%;
            animation: glowRingPulse 3s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes glowRingPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; }
        }

        /* Texto */
        .loader-text {
            color: #ffffff;
            font-family: 'Inter', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: 0.05em;
            opacity: 0;
            animation: fadeInUp 0.6s ease forwards 0.8s;
        }

        .loader-role {
            display: inline-block;
            color: transparent;
            background: linear-gradient(90deg, var(--neural-primary, #64B5F6), var(--neural-cyan, #00ffff));
            -webkit-background-clip: text;
            background-clip: text;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0;
            animation: fadeInUp 0.6s ease forwards 1s;
        }

        .loader-role::after {
            content: '|';
            color: var(--neural-cyan, #00ffff);
            animation: blink 1s step-end infinite;
            margin-left: 2px;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Neural Progress Bar */
        .loader-progress-container {
            width: 280px;
            margin-top: 2.5rem;
            opacity: 0;
            animation: fadeInUp 0.6s ease forwards 1.2s;
        }

        .loader-progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .loader-progress-value {
            color: var(--neural-cyan, #00ffff);
        }

        .loader-progress {
            width: 100%;
            height: 2px;
            background: rgba(100, 181, 246, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .loader-progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg,
                var(--neural-primary, #64B5F6),
                var(--neural-cyan, #00ffff),
                var(--neural-purple, #aa44ff));
            background-size: 200% 100%;
            border-radius: 10px;
            animation: neuralFlow 2s ease infinite;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
            transition: width 0.3s ease-out;
        }

        @keyframes neuralFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Neural skill nodes */
        .loader-skills {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            margin-top: 1.5rem;
            flex-wrap: wrap;
            max-width: 300px;
        }

        .loader-skill {
            padding: 0.35rem 0.85rem;
            background: rgba(100, 181, 246, 0.05);
            border: 1px solid rgba(100, 181, 246, 0.2);
            border-radius: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            color: rgba(255, 255, 255, 0.7);
            opacity: 0;
            transform: scale(0.8);
            box-shadow: 0 0 10px rgba(100, 181, 246, 0.1);
        }

        .loader-skill:nth-child(1) { animation: skillPop 0.4s ease forwards 1.4s; }
        .loader-skill:nth-child(2) { animation: skillPop 0.4s ease forwards 1.5s; }
        .loader-skill:nth-child(3) { animation: skillPop 0.4s ease forwards 1.6s; }
        .loader-skill:nth-child(4) { animation: skillPop 0.4s ease forwards 1.7s; }

        @keyframes skillPop {
            to { opacity: 1; transform: scale(1); }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .loader-neural-icon {
                width: 90px;
                height: 90px;
                top: 38%;
            }
            .neural-glow-ring {
                width: 110px;
                height: 110px;
            }
            .loader-content {
                margin-top: 40px;
            }
            .loader-text {
                font-size: 1.25rem;
            }
            .loader-progress-container {
                width: 220px;
            }
            .loader-skills {
                max-width: 240px;
            }
        }

        /* Reduced motion fallback */
        @media (prefers-reduced-motion: reduce) {
            .page-loader::before {
                animation: none;
            }
            .loader-progress-bar {
                animation: none;
            }
            .neural-ring,
            .neural-core,
            .neural-core-inner,
            .neural-node,
            .synapse,
            .pulse-dot,
            .neural-glow-ring {
                animation: none;
            }
            .neural-node,
            .synapse {
                opacity: 1;
                stroke-dashoffset: 0;
            }
        }

        /* ===== MAIN CONTENT REVEAL TRANSITION ===== */
        #main-content {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1),
                        transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #main-content.revealed {
            opacity: 1;
            transform: translateY(0);
        }

        /* Stagger child sections for a cascading reveal */
        #main-content.revealed > section,
        #main-content.revealed > header,
        #main-content.revealed > footer {
            animation: sectionReveal 0.6s cubic-bezier(0.4, 0, 0.2, 1) backwards;
        }

        #main-content.revealed > *:nth-child(1) { animation-delay: 0s; }
        #main-content.revealed > *:nth-child(2) { animation-delay: 0.1s; }
        #main-content.revealed > *:nth-child(3) { animation-delay: 0.15s; }
        #main-content.revealed > *:nth-child(4) { animation-delay: 0.2s; }
        #main-content.revealed > *:nth-child(5) { animation-delay: 0.25s; }
        #main-content.revealed > *:nth-child(6) { animation-delay: 0.3s; }
        #main-content.revealed > *:nth-child(7) { animation-delay: 0.35s; }
        #main-content.revealed > *:nth-child(8) { animation-delay: 0.4s; }

        @keyframes sectionReveal {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            #main-content {
                opacity: 1;
                transform: none;
                transition: none;
            }
            #main-content.revealed > section,
            #main-content.revealed > header,
            #main-content.revealed > footer {
                animation: none;
            }
        }
    </style>
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Toast Container for Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Page Loader - Neural Mind Awakening -->
    <div class="page-loader" id="page-loader">
        <!-- Three.js canvas will be inserted here -->
        <div id="loader-canvas-container"></div>

        <!-- Central neural icon -->
        <div class="loader-neural-icon">
            <svg viewBox="0 0 100 100" class="neural-svg">
                <!-- Outer ring -->
                <circle cx="50" cy="50" r="45" class="neural-ring neural-ring-outer"/>
                <circle cx="50" cy="50" r="35" class="neural-ring neural-ring-middle"/>
                <circle cx="50" cy="50" r="25" class="neural-ring neural-ring-inner"/>

                <!-- Central core -->
                <circle cx="50" cy="50" r="12" class="neural-core"/>
                <circle cx="50" cy="50" r="8" class="neural-core-inner"/>

                <!-- Neural nodes -->
                <circle cx="50" cy="15" r="4" class="neural-node node-1"/>
                <circle cx="80" cy="35" r="4" class="neural-node node-2"/>
                <circle cx="80" cy="65" r="4" class="neural-node node-3"/>
                <circle cx="50" cy="85" r="4" class="neural-node node-4"/>
                <circle cx="20" cy="65" r="4" class="neural-node node-5"/>
                <circle cx="20" cy="35" r="4" class="neural-node node-6"/>

                <!-- Synaptic connections -->
                <line x1="50" y1="15" x2="50" y2="38" class="synapse synapse-1"/>
                <line x1="80" y1="35" x2="62" y2="44" class="synapse synapse-2"/>
                <line x1="80" y1="65" x2="62" y2="56" class="synapse synapse-3"/>
                <line x1="50" y1="85" x2="50" y2="62" class="synapse synapse-4"/>
                <line x1="20" y1="65" x2="38" y2="56" class="synapse synapse-5"/>
                <line x1="20" y1="35" x2="38" y2="44" class="synapse synapse-6"/>

                <!-- Pulse particles along synapses -->
                <circle r="2" class="pulse-dot pulse-1"/>
                <circle r="2" class="pulse-dot pulse-2"/>
                <circle r="2" class="pulse-dot pulse-3"/>
            </svg>
            <div class="neural-glow-ring"></div>
        </div>

        <div class="loader-content">
            <div class="loader-text">Carlos Orbegoso</div>
            <div class="loader-role">Backend Developer</div>
            <div class="loader-progress-container">
                <div class="loader-progress-label">
                    <span class="loader-status">Initializing neural network</span>
                    <span class="loader-progress-value">0%</span>
                </div>
                <div class="loader-progress">
                    <div class="loader-progress-bar" id="loader-progress-bar"></div>
                </div>
            </div>
            <div class="loader-skills">
                <span class="loader-skill">Java</span>
                <span class="loader-skill">Spring</span>
                <span class="loader-skill">Quarkus</span>
                <span class="loader-skill">Cloud</span>
            </div>
        </div>
    </div>
    <!-- Neural Background Container (Global) -->
    <div id="neural-background-container" class="neural-background-container"></div>

    <!-- Contenedor para efectos visuales Three.js -->
    <div id="visual-effects-container" class="visual-effects-container"></div>

    <!-- Main Content -->
    <main id="main-content">
        <slot />
    </main>

    <!-- Scripts de inicialización -->
    <script>
        import '../styles/main.css';
        import { Portfolio } from '../scripts/core/Portfolio.js';
        import { LoaderProgress } from '../scripts/core/LoaderProgress.js';
        import { LoaderThreeEngine } from '../scripts/engines/loader-three-engine.js';
        import { initWebVitals } from '../scripts/utils/web-vitals.js';
        import { ScrollAnimations } from '../scripts/utils/scroll-animations.js';
        import { LazyImages } from '../scripts/utils/lazy-images.js';
        import { toast } from '../scripts/utils/toast.js';

        // Initialize Web Vitals tracking
        initWebVitals();

        // Initialize lazy loading and scroll animations
        const lazyImages = new LazyImages();
        const scrollAnimations = new ScrollAnimations();

        // Make toast available globally for copy-to-clipboard etc
        window.toast = toast;

        const loaderProgress = new LoaderProgress();

        // Initialize Three.js loader (non-blocking)
        let loaderEngine = null;
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

        if (!prefersReducedMotion) {
            loaderEngine = new LoaderThreeEngine();
            loaderEngine.init().catch(() => {
                // Fallback to CSS-only loader if Three.js fails
                loaderEngine = null;
            });
        }

        // Update both loaders
        const updateProgress = (progress) => {
            loaderProgress.updateProgress(progress);
            if (loaderEngine) {
                loaderEngine.updateProgress(progress);
            }
        };

        // Simulate initial progress
        setTimeout(() => updateProgress(15), 100);
        setTimeout(() => updateProgress(35), 400);
        setTimeout(() => updateProgress(55), 800);

        // Hide loader with explosion effect and reveal main content
        const hideLoader = async () => {
            loaderProgress.complete();

            // Trigger explosion effect if Three.js is available
            if (loaderEngine) {
                await loaderEngine.explode();
                loaderEngine.dispose();
                loaderEngine = null;
            }

            // Reveal main content with smooth transition
            const mainContent = document.getElementById('main-content');
            if (mainContent) {
                mainContent.classList.add('revealed');
            }

            setTimeout(() => loaderProgress.hide(), 200);
        };

        // Setup scroll progress indicator
        const setupScrollProgress = () => {
            const progressBar = document.querySelector('[data-header-progress]');
            if (!progressBar) return;

            window.addEventListener('scroll', () => {
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercent = (scrollTop / docHeight) * 100;
                progressBar.style.width = `${scrollPercent}%`;
            });
        };

        // Setup contact form
        const setupContactForm = () => {
            const form = document.getElementById('contact-form');
            if (!form) return;

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const submitBtn = form.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;

                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
                submitBtn.disabled = true;

                await new Promise(resolve => setTimeout(resolve, 1500));

                submitBtn.innerHTML = '<i class="fas fa-check"></i> Sent!';
                form.reset();

                setTimeout(() => {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }, 2000);
            });
        };

        document.addEventListener('DOMContentLoaded', async () => {
            updateProgress(60);

            const portfolio = new Portfolio();

            updateProgress(75);
            await portfolio.init();
            updateProgress(90);

            window.portfolio = portfolio;

            setupScrollProgress();
            setupContactForm();

            updateProgress(100);
            setTimeout(hideLoader, 600);
        });

        // Fallback: hide loader after max wait time
        window.addEventListener('load', () => {
            if (!loaderProgress.isComplete) {
                updateProgress(100);
                setTimeout(hideLoader, 800);
            }
        });
    </script>
</body>
</html>
